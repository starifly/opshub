# OpsHub è¿ç»´ç®¡ç†å¹³å°

<p align="center">
  <img src="web/public/logo.png" alt="OpsHub Logo" width="200"/>
</p>

<p align="center">
  <strong>ä¸€ä¸ªç°ä»£åŒ–ã€æ’ä»¶åŒ–çš„äº‘åŸç”Ÿè¿ç»´ç®¡ç†å¹³å°</strong>
</p>

<p align="center">
  <a href="#åŠŸèƒ½ç‰¹æ€§">åŠŸèƒ½ç‰¹æ€§</a> â€¢
  <a href="#æŠ€æœ¯æ¶æ„">æŠ€æœ¯æ¶æ„</a> â€¢
  <a href="#å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a> â€¢
  <a href="#éƒ¨ç½²æŒ‡å—">éƒ¨ç½²æŒ‡å—</a> â€¢
  <a href="#æ’ä»¶ç³»ç»Ÿ">æ’ä»¶ç³»ç»Ÿ</a> â€¢
  <a href="#å¼€å‘æŒ‡å—">å¼€å‘æŒ‡å—</a>
</p>

---

## é¡¹ç›®ç®€ä»‹

OpsHub æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è¿ç»´ç®¡ç†å¹³å°ï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒå¤šé›†ç¾¤ Kubernetes ç®¡ç†ã€RBAC æƒé™æ§åˆ¶ã€èµ„æºç›‘æ§ã€ä»»åŠ¡ç¼–æ’ç­‰åŠŸèƒ½ã€‚å¹³å°é‡‡ç”¨**æ’ä»¶åŒ–æ¶æ„**è®¾è®¡ï¼Œæ”¯æŒåŠŸèƒ½æ¨¡å—çš„**ä¸€é”®å®‰è£…ä¸å¸è½½**ï¼Œå¯æ ¹æ®å®é™…éœ€æ±‚çµæ´»æ‰©å±•ã€‚

### æ ¸å¿ƒç‰¹ç‚¹

- **æ’ä»¶åŒ–æ¶æ„** - åŠŸèƒ½æ¨¡å—ä»¥æ’ä»¶å½¢å¼å­˜åœ¨ï¼Œæ”¯æŒä¸€é”®å®‰è£…/å¸è½½ï¼ŒæŒ‰éœ€åŠ è½½
- **å¤šé›†ç¾¤ç®¡ç†** - ç»Ÿä¸€ç®¡ç†å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œæ”¯æŒä¸åŒäº‘å‚å•†
- **ç²¾ç»†åŒ–æƒé™** - å¹³å°çº§ + Kubernetes çº§åŒé‡ RBAC æƒé™æ§åˆ¶
- **å…¨é“¾è·¯å®¡è®¡** - æ“ä½œæ—¥å¿—ã€ç»ˆç«¯å®¡è®¡ã€å®Œæ•´è¿½æº¯
- **ç°ä»£åŒ–ç•Œé¢** - åŸºäº Vue 3 + Element Plus çš„å“åº”å¼ç•Œé¢

---

## åŠŸèƒ½ç‰¹æ€§

### åŸºç¡€åŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | æè¿° |
|---------|------|
| ç”¨æˆ·ç®¡ç† | ç”¨æˆ·å¢åˆ æ”¹æŸ¥ã€å¯†ç é‡ç½®ã€çŠ¶æ€ç®¡ç† |
| è§’è‰²ç®¡ç† | è§’è‰²å®šä¹‰ã€æƒé™åˆ†é…ã€è§’è‰²ç»§æ‰¿ |
| éƒ¨é—¨ç®¡ç† | ç»„ç»‡æ¶æ„ç®¡ç†ã€éƒ¨é—¨å±‚çº§ |
| èœå•ç®¡ç† | åŠ¨æ€èœå•é…ç½®ã€æƒé™ç»‘å®š |
| æ“ä½œå®¡è®¡ | å®Œæ•´çš„æ“ä½œæ—¥å¿—è®°å½•ä¸æŸ¥è¯¢ |

### æ’ä»¶åŠŸèƒ½

#### Kubernetes å®¹å™¨ç®¡ç†æ’ä»¶

æä¾›å®Œæ•´çš„ Kubernetes é›†ç¾¤ç®¡ç†èƒ½åŠ›ï¼š

| åŠŸèƒ½ | æè¿°                                              |
|-----|-------------------------------------------------|
| é›†ç¾¤ç®¡ç† | å¤šé›†ç¾¤æ¥å…¥ã€é›†ç¾¤æ¦‚è§ˆã€å¥åº·æ£€æŸ¥                                 |
| èŠ‚ç‚¹ç®¡ç† | èŠ‚ç‚¹åˆ—è¡¨ã€èµ„æºç›‘æ§ã€æ±¡ç‚¹/æ ‡ç­¾ç®¡ç†                               |
| å‘½åç©ºé—´ | å‘½åç©ºé—´ç®¡ç†ã€èµ„æºé…é¢                                     |
| å·¥ä½œè´Ÿè½½ | Deploymentã€StatefulSetã€DaemonSetã€Jobã€CronJob ç®¡ç† |
| ç½‘ç»œç®¡ç† | Serviceã€Ingressã€NetworkPolicy ç®¡ç†                |
| é…ç½®ç®¡ç† | ConfigMapã€Secret ç®¡ç†                             |
| å­˜å‚¨ç®¡ç† | PVã€PVCã€StorageClass ç®¡ç†                          |
| è®¿é—®æ§åˆ¶ | ServiceAccountã€Roleã€RoleBinding ç®¡ç†              |
| ç»ˆç«¯å®¡è®¡ | Web Terminalã€ä¼šè¯å½•åˆ¶ä¸å›æ”¾                            |
| åº”ç”¨è¯Šæ–­ | åŸºäº Arthas çš„ Java åº”ç”¨è¯Šæ–­ï¼ˆçº¿ç¨‹åˆ†æã€JVMä¿¡æ¯ã€ç«ç„°å›¾ç­‰ï¼‰**æœªå®Œæˆ**       |
 |é›†ç¾¤å·¡æ£€ | é’ˆå¯¹ä¸åŒé›†ç¾¤å¯ä¸€é”®ç”ŸæˆK8Så·¡æ£€æŠ¥å‘Š |

#### ä»»åŠ¡ä¸­å¿ƒæ’ä»¶

| åŠŸèƒ½ | æè¿° |
|-----|------|
| æ‰§è¡Œä»»åŠ¡ | è„šæœ¬æ‰§è¡Œã€æ‰¹é‡æ“ä½œ |
| æ¨¡æ¿ç®¡ç† | ä»»åŠ¡æ¨¡æ¿å®šä¹‰ä¸å¤ç”¨ |
| æ–‡ä»¶åˆ†å‘ | æ‰¹é‡æ–‡ä»¶åˆ†å‘åˆ°ç›®æ ‡ä¸»æœº |
| æ‰§è¡Œå†å² | ä»»åŠ¡æ‰§è¡Œè®°å½•ä¸æ—¥å¿—æŸ¥çœ‹ |

#### ç›‘æ§ä¸­å¿ƒæ’ä»¶

| åŠŸèƒ½ | æè¿° |
|-----|------|
| åŸŸåç›‘æ§ | SSL è¯ä¹¦ç›‘æ§ã€åˆ°æœŸæé†’ |
| å‘Šè­¦ç®¡ç† | å‘Šè­¦è§„åˆ™é…ç½®ã€å¤šæ¸ é“é€šçŸ¥ |

---

## æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„

```mermaid
graph TD
    User["ğŸ‘¥ ç”¨æˆ·å±‚<br/>(æµè§ˆå™¨/API Client)"]

    Frontend["ğŸ¨ å‰ç«¯åº”ç”¨<br/>Vue 3 + TypeScript + Element Plus + Vite<br/><br/>æ’ä»¶ç³»ç»Ÿ<br/>â”œâ”€â”€ Kubernetes æ’ä»¶<br/>â”œâ”€â”€ Task æ’ä»¶<br/>â””â”€â”€ Monitor æ’ä»¶"]

    Backend["âš™ï¸ åç«¯æœåŠ¡<br/>Go + Gin + GORM<br/><br/>æ ¸å¿ƒæ¨¡å—<br/>â”œâ”€â”€ JWT è®¤è¯<br/>â”œâ”€â”€ RBAC æƒé™<br/>â””â”€â”€ å®¡è®¡æ—¥å¿—<br/><br/>æ’ä»¶ç³»ç»Ÿ<br/>â”œâ”€â”€ Kubernetes æ’ä»¶<br/>â”œâ”€â”€ Task æ’ä»¶<br/>â””â”€â”€ Monitor æ’ä»¶"]

    Data["ğŸ’¾ æ•°æ®å±‚"]
    MySQL["ğŸ—„ï¸ MySQL<br/>æ•°æ®æŒä¹…åŒ–"]
    Redis["âš¡ Redis<br/>ç¼“å­˜/ä¼šè¯"]
    K8s["â˜¸ï¸ Kubernetes<br/>é›†ç¾¤"]

    User -->|HTTP/HTTPS| Frontend
    Frontend -->|API| Backend
    Backend --> Data
    Data --> MySQL
    Data --> Redis
    Data --> K8s

    style User fill:#e1f5ff
    style Frontend fill:#f3e5f5
    style Backend fill:#e8f5e9
    style Data fill:#fff3e0
    style MySQL fill:#fce4ec
    style Redis fill:#fce4ec
    style K8s fill:#fce4ec
```

### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | æè¿° |
|-----|------|------|
| Go | 1.21+ | åç«¯å¼€å‘è¯­è¨€ |
| Gin | 1.11+ | é«˜æ€§èƒ½ HTTP Web æ¡†æ¶ |
| GORM | 1.31+ | Go è¯­è¨€ ORM åº“ |
| Cobra | 1.10+ | CLI å‘½ä»¤è¡Œæ¡†æ¶ |
| Viper | 1.21+ | é…ç½®ç®¡ç† |
| client-go | 0.35+ | Kubernetes Go å®¢æˆ·ç«¯ |
| go-redis | 9.17+ | Redis å®¢æˆ·ç«¯ |
| jwt-go | 5.3+ | JWT è®¤è¯ |
| zap | 1.27+ | é«˜æ€§èƒ½æ—¥å¿—åº“ |
| Swagger | 1.16+ | API æ–‡æ¡£ç”Ÿæˆ |
| WebSocket | - | å®æ—¶é€šä¿¡ï¼ˆç»ˆç«¯ã€æ—¥å¿—æµï¼‰ |

### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | æè¿° |
|-----|------|------|
| Vue | 3.5+ | æ¸è¿›å¼ JavaScript æ¡†æ¶ |
| TypeScript | 5.9+ | ç±»å‹å®‰å…¨çš„ JavaScript è¶…é›† |
| Vite | 5.4+ | ä¸‹ä¸€ä»£å‰ç«¯æ„å»ºå·¥å…· |
| Element Plus | 2.13+ | Vue 3 UI ç»„ä»¶åº“ |
| Pinia | 3.0+ | Vue çŠ¶æ€ç®¡ç† |
| Vue Router | 4.6+ | Vue å®˜æ–¹è·¯ç”± |
| Axios | 1.13+ | HTTP å®¢æˆ·ç«¯ |
| xterm.js | 6.0+ | Web ç»ˆç«¯æ¨¡æ‹Ÿå™¨ |
| ECharts | 5.6+ | æ•°æ®å¯è§†åŒ–å›¾è¡¨åº“ |

### é¡¹ç›®ç»“æ„

```
opshub/
â”œâ”€â”€ cmd/                          # å‘½ä»¤è¡Œå…¥å£
â”‚   â”œâ”€â”€ root/                     # æ ¹å‘½ä»¤
â”‚   â”œâ”€â”€ server/                   # æœåŠ¡å¯åŠ¨å‘½ä»¤
â”‚   â”œâ”€â”€ config/                   # é…ç½®å‘½ä»¤
â”‚   â””â”€â”€ version/                  # ç‰ˆæœ¬ä¿¡æ¯å‘½ä»¤
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ config.yaml               # ä¸»é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ config.yaml.example       # é…ç½®æ¨¡æ¿
â”œâ”€â”€ internal/                     # å†…éƒ¨ä»£ç ï¼ˆæ ¸å¿ƒæ¨¡å—ï¼‰
â”‚   â”œâ”€â”€ biz/                      # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ conf/                     # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ data/                     # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ plugin/                   # æ’ä»¶ç³»ç»Ÿæ ¸å¿ƒ
â”‚   â”œâ”€â”€ server/                   # HTTP æœåŠ¡å™¨
â”‚   â””â”€â”€ service/                  # æœåŠ¡å±‚
â”œâ”€â”€ pkg/                          # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ error/                    # é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ logger/                   # æ—¥å¿—å°è£…
â”‚   â”œâ”€â”€ middleware/               # ä¸­é—´ä»¶
â”‚   â””â”€â”€ response/                 # å“åº”å°è£…
â”œâ”€â”€ plugins/                      # æ’ä»¶ç›®å½•
â”‚   â”œâ”€â”€ kubernetes/               # Kubernetes ç®¡ç†æ’ä»¶
â”‚   â”‚   â”œâ”€â”€ biz/                  # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ data/                 # æ•°æ®å±‚
â”‚   â”‚   â”œâ”€â”€ model/                # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ server/               # HTTP å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ service/              # æœåŠ¡å±‚
â”‚   â”‚   â””â”€â”€ plugin.go             # æ’ä»¶å…¥å£
â”‚   â”œâ”€â”€ task/                     # ä»»åŠ¡ä¸­å¿ƒæ’ä»¶
â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ server/
â”‚   â”‚   â””â”€â”€ plugin.go
â”‚   â””â”€â”€ monitor/                  # ç›‘æ§ä¸­å¿ƒæ’ä»¶
â”‚       â”œâ”€â”€ model/
â”‚       â”œâ”€â”€ repository/
â”‚       â”œâ”€â”€ server/
â”‚       â”œâ”€â”€ service/
â”‚       â””â”€â”€ plugin.go
â”œâ”€â”€ migrations/                   # æ•°æ®åº“è¿ç§»è„šæœ¬
â”œâ”€â”€ docs/                         # Swagger API æ–‡æ¡£
â”œâ”€â”€ scripts/                      # è„šæœ¬æ–‡ä»¶
â”œâ”€â”€ web/                          # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/                  # API è¯·æ±‚
â”‚   â”‚   â”œâ”€â”€ components/           # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ plugins/              # å‰ç«¯æ’ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ kubernetes/       # Kubernetes æ’ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ task/             # ä»»åŠ¡æ’ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ monitor/          # ç›‘æ§æ’ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ manager.ts        # æ’ä»¶ç®¡ç†å™¨
â”‚   â”‚   â”‚   â””â”€â”€ types.ts          # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ router/               # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ stores/               # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ views/                # é¡µé¢è§†å›¾
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”œâ”€â”€ docker-compose.yml            # Docker Compose é…ç½®
â”œâ”€â”€ Dockerfile                    # Docker æ„å»ºæ–‡ä»¶
â”œâ”€â”€ Makefile                      # æ„å»ºè„šæœ¬
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ main.go                       # ç¨‹åºå…¥å£
```

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.21+
- Node.js 18+
- MySQL 8.0+
- Redis 6.0+

### é»˜è®¤è´¦å·

- ç”¨æˆ·å: `admin`
- å¯†ç : `123456`

---

## éƒ¨ç½²æŒ‡å—

### æ–¹å¼ä¸€ï¼šDocker Composeï¼ˆæ¨èï¼‰

æœ€ç®€å•çš„éƒ¨ç½²æ–¹å¼ï¼Œä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡ã€‚

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/ydcloud-dy/opshub.git
cd opshub

# 2. åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œä½¿ç”¨é»˜è®¤é…ç½®å¯è·³è¿‡ï¼‰
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ä¿®æ”¹é…ç½®

# 3. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 4. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 5. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

è®¿é—®åœ°å€ï¼š
- å‰ç«¯: http://localhost:3000
- åç«¯ API: http://localhost:9876
- API æ–‡æ¡£: http://localhost:9876/swagger/index.html

åœæ­¢æœåŠ¡ï¼š
```bash
docker-compose down
```

### æ–¹å¼äºŒï¼šè£¸éƒ¨ç½²ï¼ˆæ‰‹åŠ¨éƒ¨ç½²ï¼‰

é€‚åˆå¼€å‘è°ƒè¯•æˆ–è‡ªå®šä¹‰éƒ¨ç½²éœ€æ±‚ã€‚

#### 1. å‡†å¤‡æ•°æ®åº“

```bash
# ç™»å½• MySQL
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE opshub CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

#### 2. é…ç½®åç«¯

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
cp config/config.yaml.example config/config.yaml

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim config/config.yaml
```

é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š
```yaml
server:
  mode: debug                    # debug, release, test
  http_port: 9876
  jwt_secret: "your-secret-key"  # ç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹

database:
  driver: mysql
  host: 127.0.0.1
  port: 3306
  database: opshub
  username: root
  password: "your-password"

redis:
  host: 127.0.0.1
  port: 6379
  password: ""
  db: 0

log:
  level: info
  filename: logs/app.log
```

#### 3. å¯åŠ¨åç«¯

```bash
# å®‰è£…ä¾èµ–
go mod tidy

# å¼€å‘æ¨¡å¼è¿è¡Œ
go run main.go server

# æˆ–è€…ç¼–è¯‘åè¿è¡Œ
make build
./bin/opshub server
```

#### 4. å¯åŠ¨å‰ç«¯

```bash
cd web

# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ„å»º
npm run build
```

### æ–¹å¼ä¸‰ï¼šè„šæœ¬éƒ¨ç½²

æä¾›ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼Œé€‚åˆå¿«é€Ÿéƒ¨ç½²åˆ°æœåŠ¡å™¨ã€‚

```bash
# ä¸‹è½½éƒ¨ç½²è„šæœ¬
curl -fsSL https://raw.githubusercontent.com/ydcloud-dy/opshub/main/scripts/install.sh -o install.sh

# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x install.sh

# æ‰§è¡Œå®‰è£…
./install.sh
```

### æ–¹å¼å››ï¼šDocker éƒ¨ç½²

å•ç‹¬ä½¿ç”¨ Docker éƒ¨ç½²åç«¯æœåŠ¡ã€‚

```bash
# æ„å»ºé•œåƒ
docker build -t opshub:latest .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name opshub \
  -p 9876:9876 \
  -e OPSHUB_DATABASE_HOST=your-mysql-host \
  -e OPSHUB_DATABASE_PASSWORD=your-password \
  -e OPSHUB_REDIS_HOST=your-redis-host \
  -e OPSHUB_SERVER_JWT_SECRET=your-jwt-secret \
  opshub:latest
```

### æ–¹å¼äº”ï¼šKubernetes éƒ¨ç½²

é€‚åˆç”Ÿäº§ç¯å¢ƒçš„å®¹å™¨åŒ–éƒ¨ç½²ã€‚

#### ä½¿ç”¨ YAML éƒ¨ç½²

```bash
# åˆ›å»ºå‘½åç©ºé—´
kubectl create namespace opshub

# åˆ›å»ºé…ç½®å¯†é’¥
kubectl create secret generic opshub-secrets \
  --from-literal=db-password=your-db-password \
  --from-literal=jwt-secret=your-jwt-secret \
  -n opshub

# éƒ¨ç½²åº”ç”¨
kubectl apply -f deploy/kubernetes/ -n opshub
```

ç¤ºä¾‹ Deployment æ–‡ä»¶ (`deploy/kubernetes/deployment.yaml`)ï¼š

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: opshub
  labels:
    app: opshub
spec:
  replicas: 2
  selector:
    matchLabels:
      app: opshub
  template:
    metadata:
      labels:
        app: opshub
    spec:
      containers:
      - name: opshub
        image: opshub:latest
        ports:
        - containerPort: 9876
        env:
        - name: OPSHUB_SERVER_MODE
          value: "release"
        - name: OPSHUB_DATABASE_HOST
          value: "mysql-service"
        - name: OPSHUB_DATABASE_PASSWORD
          valueFrom:
            secretKeyRef:
              name: opshub-secrets
              key: db-password
        - name: OPSHUB_SERVER_JWT_SECRET
          valueFrom:
            secretKeyRef:
              name: opshub-secrets
              key: jwt-secret
        resources:
          requests:
            memory: "256Mi"
            cpu: "100m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        readinessProbe:
          httpGet:
            path: /api/health
            port: 9876
          initialDelaySeconds: 5
          periodSeconds: 10
        livenessProbe:
          httpGet:
            path: /api/health
            port: 9876
          initialDelaySeconds: 15
          periodSeconds: 20
---
apiVersion: v1
kind: Service
metadata:
  name: opshub-service
spec:
  selector:
    app: opshub
  ports:
  - port: 80
    targetPort: 9876
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: opshub-ingress
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
spec:
  rules:
  - host: opshub.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: opshub-service
            port:
              number: 80
```

#### ä½¿ç”¨ Helm éƒ¨ç½²

```bash
# æ·»åŠ  Helm ä»“åº“
helm repo add opshub https://charts.opshub.io
helm repo update

# å®‰è£…
helm install opshub opshub/opshub \
  --namespace opshub \
  --create-namespace \
  --set database.host=mysql-service \
  --set database.password=your-password \
  --set server.jwtSecret=your-jwt-secret

# å‡çº§
helm upgrade opshub opshub/opshub -n opshub

# å¸è½½
helm uninstall opshub -n opshub
```

Helm values.yaml é…ç½®ç¤ºä¾‹ï¼š

```yaml
replicaCount: 2

image:
  repository: opshub
  tag: latest
  pullPolicy: IfNotPresent

server:
  mode: release
  httpPort: 9876
  jwtSecret: "your-jwt-secret"

database:
  host: mysql-service
  port: 3306
  database: opshub
  username: root
  password: "your-password"

redis:
  host: redis-service
  port: 6379
  password: ""

ingress:
  enabled: true
  className: nginx
  hosts:
    - host: opshub.example.com
      paths:
        - path: /
          pathType: Prefix

resources:
  requests:
    memory: "256Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "500m"

autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
```

---

## æ’ä»¶ç³»ç»Ÿ

OpsHub é‡‡ç”¨æ’ä»¶åŒ–æ¶æ„è®¾è®¡ï¼Œå‰åç«¯å‡å®ç°äº†å®Œæ•´çš„æ’ä»¶ç³»ç»Ÿï¼Œæ”¯æŒåŠŸèƒ½æ¨¡å—çš„åŠ¨æ€åŠ è½½ä¸å¸è½½ã€‚

### æ’ä»¶æ¶æ„è®¾è®¡

```mermaid
graph TD
    PluginMgr["ğŸ”Œ æ’ä»¶ç®¡ç†å™¨<br/>(PluginManager)"]

    K8sPlugin["â˜¸ï¸ Kubernetes æ’ä»¶<br/>å¤šé›†ç¾¤ç®¡ç†<br/>å·¥ä½œè´Ÿè½½ç®¡ç†<br/>ç»ˆç«¯å®¡è®¡"]
    TaskPlugin["âœ… Task æ’ä»¶<br/>ä»»åŠ¡ç¼–æ’<br/>æ‰¹é‡æ“ä½œ<br/>æ–‡ä»¶åˆ†å‘"]
    MonitorPlugin["ğŸ“Š Monitor æ’ä»¶<br/>åŸŸåç›‘æ§<br/>å‘Šè­¦ç®¡ç†<br/>æ€§èƒ½åˆ†æ"]

    K8sDoc["ğŸ“– Kubernetes<br/>æ’ä»¶æ–‡æ¡£"]
    TaskDoc["ğŸ“– Task<br/>æ’ä»¶æ–‡æ¡£"]
    MonitorDoc["ğŸ“– Monitor<br/>æ’ä»¶æ–‡æ¡£"]

    PluginMgr --> K8sPlugin
    PluginMgr --> TaskPlugin
    PluginMgr --> MonitorPlugin

    K8sPlugin --> K8sDoc
    TaskPlugin --> TaskDoc
    MonitorPlugin --> MonitorDoc

    click K8sDoc "docs/plugins/kubernetes.md" "Kubernetes æ’ä»¶æ–‡æ¡£"
    click TaskDoc "docs/plugins/task.md" "Task æ’ä»¶æ–‡æ¡£"
    click MonitorDoc "docs/plugins/monitor.md" "Monitor æ’ä»¶æ–‡æ¡£"

    style PluginMgr fill:#fff9c4
    style K8sPlugin fill:#c8e6c9
    style TaskPlugin fill:#bbdefb
    style MonitorPlugin fill:#ffe0b2
    style K8sDoc fill:#f8bbd0
    style TaskDoc fill:#f8bbd0
    style MonitorDoc fill:#f8bbd0
```

### åç«¯æ’ä»¶æ¥å£

æ¯ä¸ªåç«¯æ’ä»¶éœ€è¦å®ç°ä»¥ä¸‹æ¥å£ï¼š

```go
type Plugin interface {
    // æ’ä»¶å”¯ä¸€æ ‡è¯†
    Name() string

    // æ’ä»¶æè¿°
    Description() string

    // æ’ä»¶ç‰ˆæœ¬
    Version() string

    // æ’ä»¶ä½œè€…
    Author() string

    // å¯ç”¨æ’ä»¶ï¼ˆåˆå§‹åŒ–èµ„æºã€æ•°æ®åº“è¡¨ç­‰ï¼‰
    Enable(db *gorm.DB) error

    // ç¦ç”¨æ’ä»¶ï¼ˆæ¸…ç†èµ„æºï¼‰
    Disable(db *gorm.DB) error

    // æ³¨å†Œ API è·¯ç”±
    RegisterRoutes(router *gin.RouterGroup, db *gorm.DB)

    // è·å–èœå•é…ç½®
    GetMenus() []MenuConfig
}
```

### å‰ç«¯æ’ä»¶æ¥å£

æ¯ä¸ªå‰ç«¯æ’ä»¶éœ€è¦å®ç°ä»¥ä¸‹æ¥å£ï¼š

```typescript
interface Plugin {
  name: string
  description: string
  version: string
  author: string

  // å®‰è£…æ’ä»¶
  install: () => void | Promise<void>

  // å¸è½½æ’ä»¶
  uninstall: () => void | Promise<void>

  // è·å–èœå•é…ç½®
  getMenus?: () => PluginMenuConfig[]

  // è·å–è·¯ç”±é…ç½®
  getRoutes?: () => PluginRouteConfig[]
}
```

### ä¸€é”®å®‰è£…/å¸è½½

#### é€šè¿‡ç®¡ç†ç•Œé¢æ“ä½œ

1. ç™»å½•ç³»ç»Ÿåè¿›å…¥ã€Œç³»ç»Ÿç®¡ç†ã€-ã€Œæ’ä»¶ç®¡ç†ã€
2. æŸ¥çœ‹å¯ç”¨æ’ä»¶åˆ—è¡¨
3. ç‚¹å‡»ã€Œå®‰è£…ã€æŒ‰é’®å®‰è£…æ’ä»¶
4. ç‚¹å‡»ã€Œå¸è½½ã€æŒ‰é’®å¸è½½æ’ä»¶
5. åˆ·æ–°é¡µé¢ä½¿é…ç½®ç”Ÿæ•ˆ

#### é€šè¿‡ API æ“ä½œ

```bash
# è·å–æ‰€æœ‰æ’ä»¶
GET /api/v1/plugins

# å¯ç”¨æ’ä»¶
POST /api/v1/plugins/{name}/enable

# ç¦ç”¨æ’ä»¶
POST /api/v1/plugins/{name}/disable
```

### å¼€å‘æ–°æ’ä»¶

#### åç«¯æ’ä»¶å¼€å‘

1. åœ¨ `plugins/` ç›®å½•ä¸‹åˆ›å»ºæ’ä»¶ç›®å½•ï¼š

```bash
plugins/
â””â”€â”€ myplugin/
    â”œâ”€â”€ biz/           # ä¸šåŠ¡é€»è¾‘
    â”œâ”€â”€ model/         # æ•°æ®æ¨¡å‹
    â”œâ”€â”€ server/        # HTTP å¤„ç†å™¨
    â”‚   â”œâ”€â”€ handler.go
    â”‚   â””â”€â”€ router.go
    â”œâ”€â”€ service/       # æœåŠ¡å±‚
    â””â”€â”€ plugin.go      # æ’ä»¶å…¥å£
```

2. å®ç°æ’ä»¶å…¥å£ (`plugin.go`)ï¼š

```go
package myplugin

import (
    "github.com/gin-gonic/gin"
    "gorm.io/gorm"
    "github.com/ydcloud-dy/opshub/internal/plugin"
)

type Plugin struct {
    db *gorm.DB
}

func New() *Plugin {
    return &Plugin{}
}

func (p *Plugin) Name() string        { return "myplugin" }
func (p *Plugin) Description() string { return "æˆ‘çš„è‡ªå®šä¹‰æ’ä»¶" }
func (p *Plugin) Version() string     { return "1.0.0" }
func (p *Plugin) Author() string      { return "Your Name" }

func (p *Plugin) Enable(db *gorm.DB) error {
    p.db = db
    // è‡ªåŠ¨è¿ç§»æ•°æ®åº“è¡¨
    return db.AutoMigrate(&model.MyModel{})
}

func (p *Plugin) Disable(db *gorm.DB) error {
    return nil
}

func (p *Plugin) RegisterRoutes(router *gin.RouterGroup, db *gorm.DB) {
    server.RegisterRoutes(router, db)
}

func (p *Plugin) GetMenus() []plugin.MenuConfig {
    return []plugin.MenuConfig{
        {
            Name: "æˆ‘çš„åŠŸèƒ½",
            Path: "/myplugin",
            Icon: "Star",
            Sort: 200,
        },
    }
}
```

3. åœ¨ä¸»ç¨‹åºä¸­æ³¨å†Œæ’ä»¶ï¼š

```go
// cmd/server/server.go
import "github.com/ydcloud-dy/opshub/plugins/myplugin"

pluginManager.Register(myplugin.New())
```

#### å‰ç«¯æ’ä»¶å¼€å‘

1. åœ¨ `web/src/plugins/` ç›®å½•ä¸‹åˆ›å»ºæ’ä»¶ç›®å½•ï¼š

```bash
web/src/plugins/
â””â”€â”€ myplugin/
    â””â”€â”€ index.ts
```

2. å®ç°æ’ä»¶å…¥å£ï¼š

```typescript
import type { Plugin, PluginMenuConfig, PluginRouteConfig } from '../types'
import { pluginManager } from '../manager'

class MyPlugin implements Plugin {
  name = 'myplugin'
  description = 'æˆ‘çš„è‡ªå®šä¹‰æ’ä»¶'
  version = '1.0.0'
  author = 'Your Name'

  async install() {
    console.log('MyPlugin å®‰è£…ä¸­...')
  }

  async uninstall() {
    console.log('MyPlugin å¸è½½ä¸­...')
  }

  getMenus(): PluginMenuConfig[] {
    return [
      {
        name: 'æˆ‘çš„åŠŸèƒ½',
        path: '/myplugin',
        icon: 'Star',
        sort: 200,
        hidden: false,
        parentPath: '',
      },
    ]
  }

  getRoutes(): PluginRouteConfig[] {
    return [
      {
        path: '/myplugin',
        name: 'MyPlugin',
        component: () => import('@/views/myplugin/Index.vue'),
        meta: { title: 'æˆ‘çš„åŠŸèƒ½' },
      },
    ]
  }
}

const plugin = new MyPlugin()
pluginManager.register(plugin)
export default plugin
```

3. åœ¨ä¸»å…¥å£æ³¨å†Œæ’ä»¶ï¼š

```typescript
// web/src/plugins/index.ts
import './myplugin'
```

---

## ç¯å¢ƒå˜é‡

æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–é…ç½®æ–‡ä»¶ï¼Œç¯å¢ƒå˜é‡å‰ç¼€ä¸º `OPSHUB_`ã€‚

| ç¯å¢ƒå˜é‡ | æè¿° | é»˜è®¤å€¼ |
|---------|------|--------|
| `OPSHUB_SERVER_MODE` | è¿è¡Œæ¨¡å¼ (debug/release/test) | debug |
| `OPSHUB_SERVER_HTTP_PORT` | HTTP æœåŠ¡ç«¯å£ | 9876 |
| `OPSHUB_SERVER_JWT_SECRET` | JWT ç­¾åå¯†é’¥ | - |
| `OPSHUB_DATABASE_HOST` | MySQL åœ°å€ | 127.0.0.1 |
| `OPSHUB_DATABASE_PORT` | MySQL ç«¯å£ | 3306 |
| `OPSHUB_DATABASE_DATABASE` | æ•°æ®åº“å | opshub |
| `OPSHUB_DATABASE_USERNAME` | æ•°æ®åº“ç”¨æˆ·å | root |
| `OPSHUB_DATABASE_PASSWORD` | æ•°æ®åº“å¯†ç  | - |
| `OPSHUB_REDIS_HOST` | Redis åœ°å€ | 127.0.0.1 |
| `OPSHUB_REDIS_PORT` | Redis ç«¯å£ | 6379 |
| `OPSHUB_REDIS_PASSWORD` | Redis å¯†ç  | - |
| `OPSHUB_LOG_LEVEL` | æ—¥å¿—çº§åˆ« | info |

---

## å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘

```bash
# åç«¯å¼€å‘
go run main.go server

# å‰ç«¯å¼€å‘
cd web && npm run dev
```

### å¸¸ç”¨å‘½ä»¤

```bash
# æ„å»ºåç«¯
make build

# è¿è¡Œæµ‹è¯•
make test

# ä»£ç æ ¼å¼åŒ–
make fmt

# ä»£ç æ£€æŸ¥
make lint

# ç”Ÿæˆ Swagger æ–‡æ¡£
make swagger

# æ¸…ç†æ„å»ºäº§ç‰©
make clean
```

### API æ–‡æ¡£

å¯åŠ¨æœåŠ¡åè®¿é—® Swagger UIï¼š
```
http://localhost:9876/swagger/index.html
```

### æ•°æ®åº“è¿ç§»

é¡¹ç›®å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼š
- åˆ›å»º/æ›´æ–°æ•°æ®åº“è¡¨ç»“æ„
- åˆå§‹åŒ–é»˜è®¤æ•°æ®ï¼ˆç®¡ç†å‘˜è´¦å·ã€é»˜è®¤è§’è‰²ã€é»˜è®¤èœå•ç­‰ï¼‰

---

## å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

æ£€æŸ¥ MySQL æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Œé…ç½®æ˜¯å¦æ­£ç¡®ï¼š
```bash
mysql -u root -p -h 127.0.0.1 -P 3306
```

### 2. Redis è¿æ¥å¤±è´¥

æ£€æŸ¥ Redis æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š
```bash
redis-cli ping
```

### 3. å‰ç«¯æ— æ³•è®¿é—®åç«¯ API

æ£€æŸ¥è·¨åŸŸé…ç½®å’Œåç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ã€‚

### 4. Kubernetes é›†ç¾¤è¿æ¥å¤±è´¥

ç¡®ä¿ kubeconfig é…ç½®æ­£ç¡®ï¼Œé›†ç¾¤ API Server å¯è®¿é—®ã€‚

### 5. æ’ä»¶å®‰è£…åèœå•ä¸æ˜¾ç¤º

åˆ·æ–°é¡µé¢ï¼Œæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ã€‚

---

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤ Pull Request

---

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) å¼€æºè®¸å¯è¯ã€‚

---

## è”ç³»æ–¹å¼

- Issue: [GitHub Issues](https://github.com/ydcloud-dy/opshub/issues)
- Email: support@opshub.io

---

<p align="center">
  Made with â¤ï¸ by OpsHub Team
</p>
